## Fnc-patterns

A set of libraries and tools for statically linked function pattern creation and detection based on [YARA](https://virustotal.github.io/yara/) pattern matching.

This repository contains the following libraries:
* `patterngen` -- binary pattern extractor library.
* `stacofin` -- static code finder library.

This repository contains the following tools:
* `bin2pat` -- tool for generating patterns from binaries.
* `idr2pat` -- tool for extracting patterns from IDR knowledge bases.
* `pat2yara` -- tool for processing patterns to YARA signatures.
* `stacofintool` -- frontend for the `stacofin` library.

## Usage Example

### Patterngen Library

For usage examples of the Patterngen library, see the implementation of the Bin2pat tool (in `src/bin2pat`).

### Stacofin Library

For usage examples of the Stacofin library, see the implementation of Stacofintool (in `src/stacofintool`).

### Bin2pat Tool

Run `./bin2pat --help` to list all the available options.

### Idr2pat Tool

Run `./idr2pat --help` to list all the available options.

### Pat2yara Tool

Run `./pat2yara --help` to list all the available options.

### Stacofintool Tool

Run `./stacofin --help` to list all the available options.

## Requirements

* A compiler supporting C++14
  * On Windows, only Microsoft Visual C++ is supported (version >= Visual Studio 2015).
* CMake (version >= 3.6)
* Perl
  * On Windows, [Active Perl](https://www.activestate.com/activeperl) needs to be the first Perl in `PATH`, or it has to be provided to CMake using the `CMAKE_PROGRAM_PATH` variable, e.g. `-DCMAKE_PROGRAM_PATH=/c/perl/bin`.
* [GNU Bison](https://www.gnu.org/software/bison/) and [Flex](https://www.gnu.org/software/flex/).
  * On Windows, you can follow RetDec's Windows environment setup [guide](https://github.com/avast-tl/retdec/wiki/Windows-Environment) to help you get everything you need.

## Build and Installation

* Recursively clone the repository (it contains submodules):
  * `git clone --recursive https://github.com/avast-tl/fnc-patterns`
* Linux:
  * `cd fnc-patterns`
  * `mkdir build && cd build`
  * `cmake ..`
  * `make`
* Windows:
  * Open MSBuild command prompt, or any terminal that is configured to run the `msbuild` command.
  * `cd fnc-patterns`
  * `mkdir build && cd build`
  * `cmake .. -DCMAKE_INSTALL_PREFIX=<path> -G<generator>`
  * `msbuild /m /p:Configuration=Release fnc-patterns.sln`
  * Alternatively, you can open `fnc-patterns.sln` generated by `cmake` in Visual Studio IDE.

You must pass the following parameters to `cmake`:
* (Windows only) `-G<generator>` is `-G"Visual Studio 14 2015"` for 32-bit build using Visual Studio 2015, or `-G"Visual Studio 14 2015 Win64"` for 64-bit build using Visual Studio 2015. Later versions of Visual Studio may be used.

You can pass the following additional parameters to `cmake`:
* `-DFNC_PATTERNS_DOC=ON` to build with API documentation (requires Doxygen and Graphviz, disabled by default).
* `-DCMAKE_BUILD_TYPE=Debug` to build with debugging information, which is useful during development. By default, the project is built in the `Release` mode. This has no effect on Windows, but the same thing can be achieved by running `msbuild` with the `/p:Configuration=Debug` parameter.
* `-DCMAKE_PROGRAM_PATH=<path>` to use Perl at `<path>` (probably useful only on Windows).

## Library Use

### Adding Fnc-pattern libraries to your project via git submodule

The following list of library targets is exposed: `patterngen`, `stacofin`.
They can be used as follows:
```cmake
target_link_libraries(project-that-needs-patterngen patterngen)
target_link_libraries(project-that-needs-stacofin stacofin)
```

### Using Fnc-pattern libraries via CMake `find_package` command

Not supported at the moment.

## API Documentation

You can generate the API documentation by yourself. Pass `-DFNC_PATTERNS_DOC=ON` to `cmake` and run `make doc`.

## License

Copyright (c) 2017 Avast Software, licensed under the MIT license. See the `LICENSE` file for more details.

Fnc-patterns uses third-party libraries or other resources listed, along with their licenses, in the `LICENSE-THIRD-PARTY` file.

## Contributing

See [RetDec contribution guidelines](https://github.com/avast-tl/retdec/wiki/Contribution-Guidelines).
